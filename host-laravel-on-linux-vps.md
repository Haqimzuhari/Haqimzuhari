# Host for production a Laravel project on Linux(ubuntu) VPS from Github
#### Laravel project that using Livewire, unable to be run in Shared Hosting. Thus, VPS is the only solution to hosting a Laravel project for production. Linux VPS Ubuntu distro is the easiest one to setup to<br><br>VPS can be subscribe from [Digital Ocean](https://www.digitalocean.com/). One of the best so far. Very flexible and affordable. This is not paid review. Just my two cents.<br><br>But if Laravel project did't not use Livewire(why not using Livewire???) then Shared Hosting is good to go.
## First of all
##### Server environment need to be setup first.<br>Please follow [this](https://github.com/Haqimzuhari/Haqimzuhari/blob/master/ubuntu-lamp-stack-terminal.md) instruction for setting up server environment
## Install and setup Laravel dependencies
### Install Node and NPM
Installing Node.js from it's official [Github](https://github.com/nodesource/distributions/blob/master/README.md) page. Recommended to install latest version of Node.js<br>NPM will automatically installed when Node.js is installed
```bash
# Check Nodejs availibility & version
node -v
# Check NPM availibility & version
npm -v
```
### Install Composer
This installation step is from official [Composer](https://getcomposer.org/download/) page. Recommended to install latest version of Composer
### Install Laravel
This installation step is from official [Laravel](https://laravel.com/docs/8.x#installation-via-composer) page via Composer. Recommended to install latest version of Laravel
```bash
# Install Laravel via Composer
composer global require laravel/installer

# Add Laravel into global path
echo  'export PATH="$PATH:$HOME/.config/composer/vendor/bin"'  >>  ~/.bashrc
source  ~/.bashrc
```
```bash
# Check Laravel availibility & version
laravel -v
```
### Install Git
This installation step is from official [Git](https://git-scm.com/download/linux) page for Linux. Recommended to install latest version of Git
```bash
sudo add-apt-repository ppa:git-core/ppa
sudo apt update
sudo apt install git
```
```bash
# Check Git availibility & version
git --version
```
## Setup Database
### Create a database user other than root
It's is recommended to not use root user in production application
```bash
# Login into mysql as root
mysql -u root -p
<password>
```
```sql
# Create new user
CREATE USER 'user'@'localhost' IDENTIFIED BY  'password';
GRANT ALL PRIVILEGES ON  * . *  TO  'user'@'localhost';
FLUSH PRIVILEGES;
exit
```
```bash
# Login into mysql as new user
mysql -u user -p
<password>
```
```sql
# Create  Database
CREATE  DATABASE  database_name;
exit
```
## Cloning project from Github
### Setup SSH between VPS and Github for security
### Generate SSH Key
SHH key can be generated by running this procedure [here](https://docs.github.com/en/github/authenticating-to-github/connecting-to-github-with-ssh)

### Cloning Laravel Project
1. Choose your repository
2. Click `Code` button to get link to clone. Copy `SSH` link of your repository
3. Open VPS terminal
4. Run `git clone` command
```bash
sudo git clone git@github.com:{github-username}/{repo}.git /var/www/example.com
```

If `Public Key` error occur, clone repository using `https`
```bash
sudo git clone https://github.com/{github-username}/{repo}.git /var/www/example.com
```
`Github` will ask authentication and `Personal Access Token` as  password. Use your `Github` email and generate `Personal Access Token` [here](https://github.com/settings/tokens)
> `sudo` not required if target folder already has been grant create permission

## Setup Laravel Environment
### As usual
```bash
# Hop into project directory
cd /var/www/example.com

# Install Composer as production
composer install --no-dev

# Copy .env file
cp .env.example .env

# Modify .env file
sudo nano .env
 
# Artisan command
php artisan key:generate

# Migrate
php artisan migrate
# Or with seed(optional)
php artisan migrate --seed
```

#### Setup Virtual Host
```bash
sudo chown -R $USER:$USER /var/www/example.com
sudo chmod -R 777 /var/www/example.com
sudo cp /etc/apache2/sites-available/000-default.conf /etc/apache2/sites-available/example.com.conf
sudo nano /etc/apache2/sites-available/example.com.conf

<VirtualHost *:80>
	ServerAdmin administrator@example.com
	ServerName example.com
	ServerAlias www.example.com
	DocumentRoot /var/www/example.com/public
	ErrorLog ${APACHE_LOG_DIR}/error.log
	CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>

ctrl+x then y then enter to exit

sudo a2ensite example.com.conf
sudo a2dissite 000-default.conf
sudo systemctl restart apache2
sudo service apache2 restart
```
#### Enable .htaccess
```bash
sudo a2enmod rewrite
sudo nano /etc/apache2/sites-available/example.com.conf
```
Add on the first row inside `<VirtualHost></VirtualHost>`
```bash
<Directory /var/www/example.com/public>
	Options Indexes FollowSymLinks MultiViews
	AllowOverride All
	Require all granted
</Directory>
```
Save & close file then restart apache2
```bash
ctrl+x then y then enter to exit
sudo systemctl restart apache2
```
##### That pretty much it.
